# СПЕЦИФИКАЦИЯ API

Спецификация REST API версии 3.1 от 23.05.2021 для серверного приложения Афиша.Ноябрьск.

## Содержание

- [СПЕЦИФИКАЦИЯ API](#спецификация-api)
  - [Содержание](#содержание)
- [Введение в спецификацию API:](#введение-в-спецификацию-api)
  - [Роли и права доступа:](#роли-и-права-доступа)
  - [Формат запроса:](#формат-запроса)
  - [Формат ответа:](#формат-ответа)
    - [Все ответы API запросов возвращаются в формате JSON с одним из HTTP кодов ответа:](#все-ответы-api-запросов-возвращаются-в-формате-json-с-одним-из-http-кодов-ответа)
    - [Общий шаблон для всех ответов:](#общий-шаблон-для-всех-ответов)
    - [Общий шаблон для ошибок:](#общий-шаблон-для-ошибок)
- [Процесс авторизации:](#процесс-авторизации)
  - [Использование JWT для пользователей и организаторов:](#использование-jwt-для-пользователей-и-организаторов)
  - [Использование API токена для администратора:](#использование-api-токена-для-администратора)
  - [API-функции авторизации с помощью email:](#api-функции-авторизации-с-помощью-email)
    - [Локальная регистрация:](#локальная-регистрация)
    - [Локальная авторизация:](#локальная-авторизация)
  - [API-функции авторизации через ВКонтакте:](#api-функции-авторизации-через-вконтакте)
- [API-функции подсистемы пользователей:](#api-функции-подсистемы-пользователей)
  - [Административный уровень доступа:](#административный-уровень-доступа)
    - [Создание пользователя:](#создание-пользователя)
    - [Получение списка пользователей:](#получение-списка-пользователей)
    - [Удаление пользователя:](#удаление-пользователя)
  - [Пользовательский уровень доступа:](#пользовательский-уровень-доступа)
    - [Получение информации о профиле:](#получение-информации-о-профиле)
  - [Публичный уровень доступа:](#публичный-уровень-доступа)
    - [Получение информации о пользователе:](#получение-информации-о-пользователе)
- [API-функции подсистемы локаций](#api-функции-подсистемы-локаций)
  - [Административный уровень доступа:](#административный-уровень-доступа-1)
    - [Создание локации:](#создание-локации)
    - [Обновление локации:](#обновление-локации)
    - [Удаление локации:](#удаление-локации)
  - [Публичный уровень доступа:](#публичный-уровень-доступа-1)
    - [Получение списка локаций:](#получение-списка-локаций)
    - [Получение информации о локации:](#получение-информации-о-локации)
- [API-функции подсистемы типов мероприятий](#api-функции-подсистемы-типов-мероприятий)
  - [Административный уровень доступа:](#административный-уровень-доступа-2)
    - [Создание типа мероприятия:](#создание-типа-мероприятия)
    - [Удаление типа мероприятия:](#удаление-типа-мероприятия)
  - [Публичный уровень доступа:](#публичный-уровень-доступа-2)
    - [Получение списка типом мероприятий:](#получение-списка-типом-мероприятий)
- [API-функции подсистемы новостей](#api-функции-подсистемы-новостей)
  - [Административный уровень доступа:](#административный-уровень-доступа-3)
    - [Создание новости:](#создание-новости)
    - [Обновление новости:](#обновление-новости)
    - [Удаление новости:](#удаление-новости)
  - [Пользовательский уровень доступа:](#пользовательский-уровень-доступа-1)
    - [Получение списка актуальный новостей:](#получение-списка-актуальный-новостей)
    - [Получение информации о новости:](#получение-информации-о-новости)
    - [Поставить палец вверх новости:](#поставить-палец-вверх-новости)
    - [Снять палец вверх новости:](#снять-палец-вверх-новости)
- [API-функции подсистемы мероприятий](#api-функции-подсистемы-мероприятий)
  - [Административный уровень доступа:](#административный-уровень-доступа-4)
    - [Создание мероприятия:](#создание-мероприятия)
    - [Редактирование мероприятия](#редактирование-мероприятия)
    - [Удаление мероприятия:](#удаление-мероприятия)
    - [Назначение ответственного организатора:](#назначение-ответственного-организатора)
    - [Снятие ответственного организатора:](#снятие-ответственного-организатора)
  - [Пользовательский уровень доступа:](#пользовательский-уровень-доступа-2)
    - [Редактирование мероприятия организатором:](#редактирование-мероприятия-организатором)
    - [Оценка прошедшего мероприятия:](#оценка-прошедшего-мероприятия)
  - [Публичный уровень доступа:](#публичный-уровень-доступа-3)
    - [Получение списка мероприятий:](#получение-списка-мероприятий)
    - [Получение информации о мероприятии:](#получение-информации-о-мероприятии)

# Введение в спецификацию API:

API соответствует архитектурному стилю взаимодействия REST.

Все запросы осуществляются посредством протокола прикладнного уровня модели OSI - HTTPS.

Ниже описаны подробности используемых ролей с разделённым уровнем доступа, форматов запросов и ответов.

## Роли и права доступа:

Существует четыре роли с различными правами доступа:
- **администратор**; 
- **организатор**; 
- **пользователь**;
- **гость**.

**Гость** является ролью по умолчанию для неавторизованных запросов к API с публичным доступом, такие как просмотр мероприятий или новостей.

Все роли имеют иерархический принцип наследования прав доступа. **Администратор** имеет высшие права.

Некоторые функции API доступны только для определенной роли, например получение информации о профиле.

В документации явно указано, какая минимальная роль необходима для использования той или инной функции API.

Подробнее об авторизации для разных ролей, написано в разделе [Процесс авторизации](#процесс-авторизации)

## Формат запроса:

Все API запросы отправляются по маршрутам с обязательным URL префиксом (далее API_PREFIX):
```url
https://qevent.slar.ru/api/v3
```
На все запросы распространяются следующие правила и свойства:

1. Запросы **GET** и **DELETE** исключают наличие тела запроса и являются идемпотентными. 
2. Все параметры в запросах **GET** и **DELETE** передаются прямо в URL (обозначаются в документации по шаблону *:param*) после знака ? и разделяются &. 
3. Запросы **POST** и **PUT** могут содержать URL параметры (обозначаются в документации по шаблону *:param*) и тело запроса в одном из следующих форматов:
   - `application/x-www-form-urlencoded` - в случае, если тело запроса не предполагает наличие полей с файлами;
   - `multipart/form-data` - в случае, если запрос предполагает наличие полей с файлами по спецификации.

Необязательный поля в теле запроса обозначаются в документации как *опционально*.

## Формат ответа:

### Все ответы API запросов возвращаются в формате JSON с одним из HTTP кодов ответа:
   - `OK 200` - Запрос прошел успешно
   - `Bad Request 400` - Неверный запрос или ошибка валидации данных
   - `Unauthorized 401` - Не авторизован на сервере
   - `Forbidden 403` - Недостаточный уровень доступа для текущей роли или доступ заблокирован
   - `Internal Error 500` - Внутренняя ошибка севера

### Общий шаблон для всех ответов:

```json
{
    "success": true,
    "other_field1": "...",
    "other_field2": {  }
}
```

### Общий шаблон для ошибок:

Вместе с HTTP кодом ошибки, API функция также предоставляет дополнительные данные. 

#### Краткий:

```json
{
    "success": false,
    "code": "errorcode",
    "msg": "Error messege"
}
```

#### Расширенный:
В расширенном отчете об ошибке также представлен объекты-причины ее возникновения с указанием поля и типа ошибки.

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Bad request",
    "reason": [
        {
            "message": "lastName cannot be null",
            "type": "Null Violation",
            "path": "lastName",
            "value": null
        }
    ]
}
```

# Процесс авторизации:

В этом разделе описан процесс авторизации, регистрации и аутентификации для пользователей, организаторов и администраторов.

## Использование JWT для пользователей и организаторов:

JSON Web Token (JWT) — это открытый стандарт `RFC 7519` для создания токенов доступа, основанный на формате JSON.

   - В случае успешной авторизации (правильный пароль и email для локальной или завершённый процесс OAuth 2.0), сервер выдаёт JWT токен.
   - JWT токен должен хранится на клиенте и использоваться в API, требующий **Пользовательский** или **Организаторский** уровень доступа в виде значения HTTP заголовка `Authorization`.
   - Срок жизни JWT токена составляет 10 дней с момента выдачи, после чего клиенту необходимо запросить новый, пройдя процедуру аутентификации.
   - В случае отсутствия токена, будет выдана ошибка с HTTP кодом 401:
   ```json
    {
        "success": false,
        "code": "no_token_supplied",
        "msg": "Authentication failed. Token not provided."
    }
   ```

## Использование API токена для администратора:

   - **API admin токен** - это секретный токен, выдаваемый администратору навсегда.
   - **API admin токен** должен хранится у администратора и использоваться в API, требующий **Административный уровень доступа** в виде значения заголовка `Authorization`.

## API-функции авторизации с помощью email:

Локальная авторизация предполагает предоставление заранее зарегистрированной валидной пары email-пароль для выдачи JWT токена.

### Локальная регистрация:

`POST API_PREFIX/user/register/local`

Регистрация пользователя с локальным способом авторизации (email).

##### Должен быть со следующими полями: 

1. `email` - Email аккаунта (должен быть в формате e-mail)
2. `password` - Пароль аккаунта (6..32 символа)
3. `firstName` - Имя пользователя (2..24 символа)
3. `lastName` - Фамилия пользователя (2..24 символа)
4. `avatar` - Аватар пользователя, файл изображения в jpg или png формате. Будет обрезан по центру до 1024 пикселей по тем сторонам, которые больше этого значения. Должен быть меньше 5мб. *опционально*

#### Запрос с помощью curl:

```bash
curl --location --request POST 'https://qevent.slar.ru/api/v3/user/register/local' \
--form 'email=test3@ya.ru' \
--form 'password=123456' \
--form 'firstName=Константин' \
--form 'lastName=Малинов' \
--form 'role=organizator' \
--form 'avatar=@/Users/admin/Downloads/Astronaut.jpg'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "msg": "Successful created new user"
}
```

##### 400 Bad Request (для примера, не включим email в запрос):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Bad request",
    "reason": [
        {
            "message": "MailAccount.email cannot be null",
            "type": "notNull Violation",
            "path": "email",
            "value": null
        }
    ]
}
```

### Локальная авторизация:

`POST API_PREFIX/user/auth/local`

Авторизация пользователя с ролью **Пользователь** или **Организатор** с локальным способом авторизации (email).

##### Должен быть со следующими полями:

1. `email` - Email аккаунта (должен быть в формате e-mail)
2. `password` - Пароль аккаунта (6..32 символа)

#### Запрос с помощью curl:

```bash
curl --location --request POST 'https://qevent.slar.ru/api/v3/user/auth/local' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'email=test3@ya.ru' \
--data-urlencode 'password=123456' \
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1Ni...",
    "firebaseToken": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userId": "449524ee-dd27-4642-9c5e-ec0ffcafcebe",
    "userRole": "user"
}
```
Возвращаемые поля:
1. `token` - JWT-токен с сроком жизни 10 дней.
2. `firebaseToken` - токен для клиентской авторизации в Firebase.
3. `userId` - UUID пользователя.
4. `userRole` - Роль пользователя: *user* или *organizator*.


##### 401 Bad Request (для примера, пароль не верный):

```json
{
    "success": false,
    "code": "auth_failed",
    "msg": "Authentication failed"
}
```

## API-функции авторизации через ВКонтакте:

`POST API_PREFIX/user/auth/vk`

Авторизация пользователя с помощью соц. сети. ВКонтакте.

##### Должен быть со следующими полями:

1. `token` - access_token auth 2.0 пользователя вк, полученный на клиенте 

#### Запрос с помощью curl:

```bash
curl --location --request POST 'http://qevent.slar.ru/api/v3/user/auth/vk' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'token=9e3c270a09f37f5edd62fde89fb1a7ce8ba9bddd0c62017f50731c931590efc710e5'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "userId": "e7308d45-576b-4f15-a3e3-a0e4e1cdb9b7",
    "firstAuth": false
}
```

1.`token` - JWT-токен с сроком жизни 10 дней.
2.`userId` - UUID пользователя.
3.`firstAuth` - Флаг. Если true, то пользователь с таким ВКонтакте id авторизовался впервые (прошла регистрация).
4. `userRole` - Роль пользователя: *user* или *organizator*.

##### 400 Bad Request (для примера, токен неверного формата):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Bad request",
    "reason": [
        {
            "message": "Access denied: Incorrect token invalid_token",
            "type": null,
            "path": "token",
            "value": "9e3c270a09f37f5edd62fde89fb1a7ce8ba9bddd0c6201978651eb02647f2617f50731c931590efc710e5"
        }
    ]
}
```

# API-функции подсистемы пользователей:

## Административный уровень доступа:

### Создание пользователя:

`POST API_PREFIX/user/create`

Создание пользователя с заданной ролью (**user** or **organizator**) с локальным способом авторизации (email).

##### Должен быть со следующими полями:

1. `email` - Email аккаунта (должен быть в формате e-mail)
2. `password` - Пароль аккаунта (6..32 символа)
3. `firstName` - Имя пользователя (2..24 символа)
3. `lastName` - Фамилия пользователя (2..24 символа)
4. `role` - Роль пользователя (должна быть `user` или `organizator`)
5. `avatar` - Аватар пользователя, файл изображения в jpg или png формате. Будет обрезан по центру до 1024 пикселей по тем сторонам, которые больше этого значения. Должен быть меньше 5мб.*опционально*

#### Запрос с помощью curl:

```bash
curl --location --request POST 'https://qevent.slar.ru/api/v3/user/create' \
--header 'Authorization: ADMIN_API_TOKEN' \
--form 'email=test3@ya.ru' \
--form 'password=123456' \
--form 'firstName=Константин' \
--form 'lastName=Малинов' \
--form 'role=organizator' \
--form 'avatar=@/Users/admin/Downloads/Astronaut.jpg'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "newUserId": "5a12dfc6-8eba-43a3-a417-bc8a6ca37e15" 
}
```

`newUserId` - UUID нового пользователя

##### 400 Bad Request (для примера, не включим email в запрос):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Bad request",
    "reason": [
        {
            "message": "MailAccount.email cannot be null",
            "type": "notNull Violation",
            "path": "email",
            "value": null
        }
    ]
}
```

### Получение списка пользователей:

`GET API_PREFIX/user/list/all`

Получение списка всех пользователей (кроме администраторов)

#### Запрос с помощью curl:

```bash
curl --location --request GET 'https://qevent.slar.ru/api/v3/user/list/all' \
--header 'Authorization: ADMIN_API_TOKEN' \
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "usersCount": 2,
    "users": [
        {
            "id": "5a12dfc6-8eba-43a3-a417-bc8a6ca37e15",
            "firstName": "Климашин",
            "lastName": "Максим",
            "role": "user",
            "avatarImg": "https://qevent.slar.ru/storage/images/cb5e6f1a7bce87f0/avatar_1606512497368.jpg"
        },
        {
            "id": "71c460e8-9de0-46d9-adbd-9df2c0bdbc1d",
            "firstName": "Малинов",
            "lastName": "Константин",
            "role": "organizator",
            "avatarImg": "https://qevent.slar.ru/storage/images/b5dcdc2c1777f613/avatar_1606600767168.jpg"
        }
    ]
}
```

1. `usersCount` - Количество пользователей.
2. `firstName` - Имя пользователя (2..24 символа).
3. `lastName` - Фамилия пользователя (2..24 символа).
4. `role` - Роль пользователя (может быть `user` или `organizator`).
5. `avatar` - URL до аватара пользователя.
   
### Удаление пользователя:

`DELETE API_PREFIX/user/:UUID`

Удаление конкретного пользователя.

#### Параметры:

*UUID* - identifier of specific user

#### Запрос с помощью curl:

```bash
curl --location --request DELETE 'https://qevent.slar.ru/api/v3/user/449524ee-dd27-4642-9c5e-ec0ffcafcebe' \
--header 'Authorization: ADMIN_API_TOKEN'
```

#### Ответ:

##### 200 OK:

```json
{
    "success": true
}
```

##### 404 Not found:

```json
{
    "success": false,
    "code": "notfound",
    "msg": "User not exist!"
}
```

## Пользовательский уровень доступа:

### Получение информации о профиле:

`GET API_PREFIX/user/self`

Получение информации о своём профиле

#### Запрос с помощью curl:

```bash
curl --location --request GET 'https://qevent.slar.ru/api/v3/user/self' \
--header 'Authorization: JWT' \
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "user": {
        "id": "449524ee-dd27-4642-9c5e-ec0ffcafcebe",
        "firstName": "Климашин",
        "lastName": "Максим",
        "role": "user",
        "avatarImg": "https://qevent.slar.ru/storage/images/20a2f34c36da8659/avatar_1606402703968.jpg"
    }
}
```

1. `firstName` - Имя пользователя (2..24 символа).
2. `lastName` - Фамилия пользователя (2..24 символа).
3. `role` - Роль пользователя (может быть `user` или `organizator`).
4. `avatar` - URL до аватара пользователя.

## Публичный уровень доступа:

### Получение информации о пользователе:

`GET API_PREFIX/user/getInfo/:UUID`

Получение информации об определенном пользователе

#### Параметры:

*UUID* - UUID определенного пользователя

#### Запрос с помощью curl:

```bash
curl --location --request GET 'https://qevent.slar.ru/api/v3/user/getInfo/20e2a0b6-2de3-4059-beab-3b9b2720efa7' \
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "user": {
        "id": "449524ee-dd27-4642-9c5e-ec0ffcafcebe",
        "firstName": "Климашин",
        "lastName": "Максим",
        "role": "user",
        "avatarImg": "https://qevent.slar.ru/storage/images/20a2f34c36da8659/avatar_1606402703968.jpg"
    }
}
```

1. `firstName` - Имя пользователя (2..24 символа).
2. `lastName` - Фамилия пользователя (2..24 символа).
3. `role` - Роль пользователя (может быть `user` или `organizator`).
4. `avatar` - URL до аватара пользователя.

##### 404 Not Found:
```json
{
    "success": false,
    "code": "notfound",
    "msg": "User not found"
}
```
# API-функции подсистемы локаций

Этот раздел описывает API для локаций: функции для создания, редактирования, просмотра списков и отдельных локаций, а также удаления и выборке мероприятий по определенной локации.

## Административный уровень доступа:

### Создание локации:

`POST API_PREFIX/geo/add/`

Добавление новой локации.

##### Должен быть со следующими полями: 

1. `name` - Наименование локации (1..120 символов).
2. `latitude` - Широта географических координат (-90..90, число с плавающей точкой).
3. `longitude` - Долгота географических координат (-180..180, число с плавающей точкой).
4. `radius` - Радиус локации в метрах (>0).

#### Запрос с помощью curl:

```bash
curl -L -X POST 'API_PREFIX/geo/add/' \
-H 'Authorization: ADMIN_TOKEN' \
-H 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'name=Севастополь' \
--data-urlencode 'latitude=44.616495' \
--data-urlencode 'longitude=33.525126' \
--data-urlencode 'radius=12000'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "newCityId": "0bb20518-a009-44a3-9308-669ace79b63d"
}
```

`newCityId` - UUID созданной локации

##### 400 Bad Request (для примера, попытка создать два города с одним наименованием):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Bad request",
    "reason": [
        {
            "message": "This city name is already exist",
            "type": "unique violation",
            "path": "name",
            "value": "Севастополь"
        }
    ]
}
```

### Обновление локации:

`PUT API_PREFIX/geo/update/:uuid`

Обновление существующей локации.

#### Параметры:

*uuid* - UUID существующей локации

##### Должен быть со следующими полями: 

1. `name` - Наименование локации (1..120 символов).
2. `latitude` - Широта географических координат (-90..90, число с плавающей точкой).
3. `longitude` - Долгота географических координат (-180..180, число с плавающей точкой).
4. `radius` - Радиус локации в метрах (>0).

#### Запрос с помощью curl:

```bash
curl -L -X PUT 'API_PREFIX/geo/update/:uuid' \
-H 'Authorization: ADMIN_TOKEN' \
-H 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'name=Севастополь' \
--data-urlencode 'latitude=44.616495' \
--data-urlencode 'longitude=33.525126' \
--data-urlencode 'radius=12000'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true
}
```

##### 400 Bad Request (для примера, попытка ввода неверной широты):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Error form validating!",
    "reason": [
        "instance.latitude must be greater than or equal to -90"
    ]
}
```

### Удаление локации:

`DELETE API_PREFIX/geo/remove/:uuid`

Удаление существующей локации.

#### Параметры:

*uuid* - UUID существующей локации

#### Запрос с помощью curl:

```bash
curl -L -X DELETE 'API_PREFIX/geo/remove/:uuid' \
-H 'Authorization: ADMIN_TOKEN' \
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true
}
```

##### 404 Not Found (для примера, попытка ввода несуществующего uuid):

```json
{
    "success": false,
    "msg": "City not exist!"
}
```

## Публичный уровень доступа:

### Получение списка локаций:

`GET API_PREFIX/geo/`

Получение списка всех актуальных локаций.

#### Запрос с помощью curl:

```bash
curl -L -X GET 'API_PREFIX/geo/'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "cities": [
        {
            "id": "0bb20518-a009-44a3-9308-669ace79b63d",
            "name": "Севастополь",
            "radius": 12000,
            "longitude": 33.525126,
            "latitude": 44.616495
        }
    ]
}
```

1. `name` - Наименование локации.
2. `latitude` - Широта географических координат.
3. `longitude` - Долгота географических координат.
4. `radius` - Радиус локации в метрах.

### Получение информации о локации:

`GET API_PREFIX/geo/:uuid`

Получение информации об определенной локаций.

#### Параметры:

*uuid* - UUID существующей локации

#### Запрос с помощью curl:

```bash
curl -L -X GET 'API_PREFIX/geo/:uuid'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "city": {
        "id": "0bb20518-a009-44a3-9308-669ace79b63d",
        "name": "Севастополь",
        "radius": 12000,
        "longitude": 33.525126,
        "latitude": 44.616495
    }
}
```

1. `name` - Наименование локации.
2. `latitude` - Широта географических координат.
3. `longitude` - Долгота географических координат.
4. `radius` - Радиус локации в метрах.

# API-функции подсистемы типов мероприятий

Этот раздел описывает API для типов мероприятий: функции для создания, просмотра списков, а также удаления и выборке мероприятий по определенному типу.

## Административный уровень доступа:

### Создание типа мероприятия:

`POST API_PREFIX/tag/add/`

Добавление нового типа мероприятия.

##### Должен быть со следующими полями: 

1. `title` - Наименование типа мероприятия (1..120 символов).

#### Запрос с помощью curl:

```bash
curl -L -X POST 'API_PREFIX/tag/add/' \
-H 'Authorization: ADMIN_TOKEN' \
-H 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'title=Театр'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "newTag": "Театр"
}
```

`newTag` - Только что созданный тип мероприятия

##### 400 Bad Request (для примера, попытка создать два одинаковых типа мероприятия):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Bad request",
    "reason": [
        {
            "message": "title must be unique",
            "type": "unique violation",
            "path": "title",
            "value": "Театр"
        }
    ]
}
```

### Удаление типа мероприятия:

`DELETE API_PREFIX/tag/remove/:uuid`

Удаление существующей локации.

#### Параметры:

*uuid* - UUID существующей локации

#### Запрос с помощью curl:

```bash
curl -L -X DELETE 'API_PREFIX/tag/remove/:uuid' \
-H 'Authorization: ADMIN_TOKEN' \
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true
}
```

##### 404 Not Found (для примера, попытка ввода несуществующего uuid):

```json
{
    "success": false,
    "msg": "Tag not exist!"
}
```

## Публичный уровень доступа:

### Получение списка типом мероприятий:

`GET API_PREFIX/tag/`

Получение списка всех типов мероприятий.

#### Запрос с помощью curl:

```bash
curl -L -X GET 'API_PREFIX/tag/'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "tags": [
        "Театр",
        "Для детей",
        "Культура"
    ]
}
```

1. `tags` - Массив строк типов мероприятий.

# API-функции подсистемы новостей

Этот раздел описывает API для новостей и записей: функции для создания, редактирования, просмотра списков и отдельных новостей, а также удаления и выборке записей определенного мероприятия.

## Административный уровень доступа:

### Создание новости:

`POST API_PREFIX/post/add/`

Добавление новости.

##### Должен быть со следующими полями: 

1. `text` - Текстовое наполнение новости (0..1400 символов). **опционально**
2. `images` - Набор файлов изображений новости. Максимум 10 файлов. Изображение будет сжиматься по разрешению до 512 пикселей по большей стороне. **опционально**
3. `videos` - Набор файлов видеороликов новостей.  Максимум 10 файлов. Видео будет сжиматься до битрейта 1.5 мбит/сек и разрешения 480 пикселей по меньшей стороне. **опционально**
4. `eventId` - UUID мероприятия, к которому прикрепляется запись. **опционально**

#### Запрос с помощью curl:

```bash
curl -L -X POST 'API_PREFIX/post/add/' \
-H 'Authorization: ADMIN_TOKEN' \
-F 'text="Тест новости"' \
-F 'images=@"pexels-photo-2379004.jpeg"' \
-F 'videos=@"coverr-blueberries.mp4"' \
-F 'eventId="0be726e9-0715-49c7-a969-579aa0c6ac32"'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "newPostId": "82a3168b-cb8d-4e35-a4ff-c7f3f1c3fb0b"
}
```

`newPostId` - UUID созданной новости.

##### 400 Bad Request (для примера, попытка ввода слишком длинного текста):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Bad request",
    "reason": [
        {
            "message": "Validation len on text failed",
            "type": "Validation error",
            "path": "text",
            "value": "Тест 2 фыТест..."
        }
    ]
}
```

### Обновление новости:

`PUT API_PREFIX/post/update/:uuid`

Обновление существующей новости.

#### Параметры:

*uuid* - UUID существующей новости

##### Должен быть со следующими полями: 

1. `text` - Новое текстовое наполнение новости (0..1400 символов). **опционально**
2. `images` - Новый набор файлов изображений новости. Максимум 10 файлов. Изображение будет сжиматься по разрешению до 512 пикселей по большей стороне. **опционально**
3. `videos` - Новый набор файлов видеороликов новостей.  Максимум 10 файлов. Видео будет сжиматься до битрейта 1.5 мбит/сек и разрешения 480 пикселей по меньшей стороне. **опционально**
4. `eventId` - Новый UUID мероприятия, к которому прикрепляется запись. **опционально**

#### Запрос с помощью curl:

```bash
curl -L -X PUT 'API_PREFIX/post/update/:uuid' \
-H 'Authorization: ADMIN_TOKEN' \
-F 'text="Тест новости 2"' \
-F 'images=@"pexels-photo-2379004.jpeg"' \
-F 'videos=@"coverr-blueberries.mp4"' \
-F 'eventId="0be726e9-0715-49c7-a969-579aa0c6ac32"'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true
}
```

##### 400 Bad Request (для примера, попытка ввода неверной широты):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Error form validating!",
    "reason": [
        "instance.latitude must be greater than or equal to -90"
    ]
}
```

### Удаление новости:

`DELETE API_PREFIX/post/remove/:uuid`

Удаление существующей новости.

#### Параметры:

*uuid* - UUID существующей новости

#### Запрос с помощью curl:

```bash
curl -L -X DELETE 'API_PREFIX/post/remove/:uuid' \
-H 'Authorization: ADMIN_TOKEN' \
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true
}
```

##### 404 Not Found (для примера, попытка ввода несуществующего uuid):

```json
{
    "success": false,
    "msg": "Post not exist!"
}
```

## Пользовательский уровень доступа:

Для организаторов доступны все те же API, что и для администраторов, в том случае, если организатор является ответственным над мероприятием, где хочет работать с новостями.

### Получение списка актуальный новостей:

`GET API_PREFIX/post/`

Получение списка всех актуальных локаций.

#### Запрос с помощью curl:

```bash
curl -L -X GET 'API_PREFIX/post/' -H 'Authorization: JWT'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "posts": [
        {
            "id": "a594a735-d8b4-4f72-82bf-20b26a680ebe",
            "createdAt": "2021-06-22T04:05:48.183Z",
            "likesCount": "0",
            "Event": null,
            "Author": null,
            "Content": {
                "Text": "Тест записи события 34",
                "Images": [
                    "HOST_URL/storage/images/551dd76c6b38c42e/picture0_1624334748186.jpg"
                ],
                "Videos": [
                    {
                        "path": "HOST_URL/storage/videos/bf5666b585e9ced6/video-0_22040548.mp4",
                        "status": "done",
                        "thumbnail": "HOST_URL/storage/images/bf5666b585e9ced6/video-0_1624334750720.jpg"
                    }
                ]
            },
            "isLiked": false
        },
        {
            "id": "82a3168b-cb8d-4e35-a4ff-c7f3f1c3fb0b",
            "createdAt": "2021-06-22T04:01:58.860Z",
            "likesCount": "0",
            "Event": null,
            "Author": null,
            "Content": {
                "Text": "Тест 2",
                "Images": [
                    "HOST_URL/storage/images/e0d1ae663b3601ae/picture0_1624334518866.jpg"
                ],
                "Videos": [
                    {
                        "path": "HOST_URL/storage/videos/bf5666b585e9ced6/video-0_22040200.mp4",
                        "status": "done",
                        "thumbnail": "HOST_URL/storage/images/bf5666b585e9ced6/video-0_1624334523165.jpg"
                    }
                ]
            },
            "isLiked": false
        }
    ]
}
```

1. `createdAt` - Дата публикации новости.
2. `likesCount` - Количество пальцев вверх.
3. `Event` - Привязанное к новости мероприятие (в случае null - новость глобальная).
4. `Author` - Профиль автора новости (в случае null - создатель администратор).
5. `isLiked` - Флаг истинности факта того, что пользователь, вызвавший API, поставил палец вверх.
6. `Content` - Объект содержимого новости.
7. `Text` - Текстовое содержимое новости.
8. `Images` - Массив строк - URLs изображений новостей.
9. `Videos` - Массив объектов-видеороликов;
10. `Videos.path` - URL видеофайла.
11. `Videos.status` - Статус обработки видеороликов (pending, failed, done).
12. `Videos.thumbnail` - URL обложки видеоролика.

### Получение информации о новости:

`GET API_PREFIX/post/:uuid`

Получение ифнормации об определенной новости.

#### Параметры:

*uuid* - UUID существующей новости или записи

#### Запрос с помощью curl:

```bash
curl -L -X GET 'API_PREFIX/post/:uuid' -H 'Authorization: JWT'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true,
    "post": {
        "id": "a594a735-d8b4-4f72-82bf-20b26a680ebe",
        "createdAt": "2021-06-22T04:05:48.183Z",
        "likesCount": "0",
        "Event": null,
        "Author": null,
        "Content": {
            "Text": "Тест записи события 34",
            "Images": [
                "HOST_URL/storage/images/551dd76c6b38c42e/picture0_1624334748186.jpg"
            ],
            "Videos": [
                {
                    "path": "HOST_URL/storage/videos/bf5666b585e9ced6/video-0_22040548.mp4",
                    "status": "done",
                    "thumbnail": "HOST_URL/storage/images/bf5666b585e9ced6/video-0_1624334750720.jpg"
                }
            ]
        },
        "isLiked": false
    }
}
```

1. `createdAt` - Дата публикации новости.
2. `likesCount` - Количество пальцев вверх.
3. `Event` - Привязанное к новости мероприятие (в случае null - новость глобальная).
4. `Author` - Профиль автора новости (в случае null - создатель администратор).
5. `isLiked` - Флаг истинности факта того, что пользователь, вызвавший API, поставил палец вверх.
6. `Content` - Объект содержимого новости.
7. `Text` - Текстовое содержимое новости.
8. `Images` - Массив строк - URLs изображений новостей.
9. `Videos` - Массив объектов-видеороликов;
10. `Videos.path` - URL видеофайла.
11. `Videos.status` - Статус обработки видеороликов (pending, failed, done).
12. `Videos.thumbnail` - URL обложки видеоролика.

### Поставить палец вверх новости:

`PUT API_PREFIX/post/:uuid/like`

Поставить палец вверх определенной новости.
Запрос неидемпотентный.

#### Параметры:

*uuid* - UUID существующей новости или записи

#### Запрос с помощью curl:

```bash
curl -L -X PUT 'API_PREFIX/post/:uuid/like'  -H 'Authorization: JWT'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true
}
```

##### 409 Conflict:
```json
{
    "success": false,
    "code": "conflict",
    "msg": "Already liked the post!"
}
```

### Снять палец вверх новости:

`PUT API_PREFIX/post/:uuid/like`

Снять палец вверх с определенной новости.
Запрос неидемпотентный.

#### Параметры:

*uuid* - UUID существующей новости или записи

#### Запрос с помощью curl:

```bash
curl -L -X PUT 'API_PREFIX/post/:uuid/unlike'  -H 'Authorization: JWT'
```

#### Ответ:

##### 200 OK:
```json
{
    "success": true
}
```

##### 409 Conflict:
```json
{
    "success": false,
    "code": "conflict",
    "msg": "Not liked the post!"
}
```

# API-функции подсистемы мероприятий

Этот раздел описывает API для мероприятий: функции для создания, редактирования, просмотра списков и отдельных мероприятий, подписки на событие, назначение ответственных организаторов а также удаления.

## Административный уровень доступа:

### Создание мероприятия:

`POST API_PREFIX/event/add/`

Добавление нового мероприятия администратором.

##### Должен быть со следующими полями: 

1. `title` - Название (2..40 символов)
2. `description` - Описание (0..1400 символов)
3. `schedule` - JSON массив объектов расписания.
4. `regionId` - UUID существующей локации, например города, где проходит мероприятие.
5. `tags` - JSON массив строк - существующих типов мероприятия.
6. `photos` - файлы изображения мероприятия в jpg или png формате. Максимум 10 файлов. Будут обрезаны по центру до 1024 пикселей по тем сторонам, которые больше этого значения. Каждый файл должен быть меньше 5мб.

Содержимое объектов JSON массива `schedule`:

1. `dateFrom` - Дата начала отдельной встречи мероприятия (дата со временем в ISO формате в UTC).
2. `dateTo` - Дата окончания отдельной встречи мероприятия (дата со временем в ISO формате в UTC). Должна быть позже, чем дата начала. Должна равняться дате начала мероприятия, если мероприятие не продолжительно во времени.
3. `address` - Текстовое описание адреса проведения мероприятия, который должен описывать конкретную точку. После создания, по этому адресу будут геокодированы географические координаты. **опционально**
4. `latitude` и `longitude` - Альтернатива текстовому адресу в виде географических координат широты и долготы. После создания, по координатам будет геокодирован тестовой адрес. **опционально**

#### Запрос с помощью curl:

```bash
curl -L -X POST 'API_PREFIX/event/add/' \
-H 'Authorization: ADMIN_TOKEN' \
-F 'title="Новое мероприятие"' \
-F 'description="Описание меропрития"' \
-F 'schedule="[
    {
        \"dateFrom\": \"2020-12-10T10:20:30Z\",
        \"dateTo\": \"2020-12-10T12:20:30Z\",
        \"address\": \"Севастополь, ул. Шевченко, 52\"
    },
    {
        \"dateFrom\": \"2020-12-12T10:20:30Z\",
        \"dateTo\": \"2020-12-12T12:20:30Z\",
        \"latitude\": 44.595272,
        \"longitude\": 33.484541
    }
]"' \
-F 'tags="[\"Театр\"]"' \
-F 'photos=@"pexels-photo-2379004.jpeg"' \
-F 'regionId="0bb20518-a009-44a3-9308-669ace79b63d"'
```

#### Ответ:

##### 200 OK:
```json
{
    "success":true,
    "newEventId":"2170d275-4ddd-43ed-881f-569351bccb3e"
}
```
`newEventId` - UUID созданного мероприятия

##### 400 Bad Request (для примера не укажем никакой тип адреса в расписании):

```json
{
    "success": false,
    "code": "badrequest",
    "msg": "Error form validating!",
    "reason": [
        "instance must have address or latitude & longitude"
    ]
}
```

### Редактирование мероприятия

`PUT API_PREFIX/event/update/:UUID`

Редактирование информации опредленного мероприятия.

#### Параметры:

*UUID* - UUID опредленного мепроприятия

##### Должен быть со следующими полями: 

1. `title` - Новое название (2..40 символов) **опционально**
2. `description` - Новое Описание (0..1400 символов) **опционально**
3. `schedule` - JSON массив объектов нового расписания. **опционально**
4. `regionId` - UUID новой существующей локации, например города, где проходит мероприятие. **опционально**
5. `tags` - JSON массив строк - новых существующих типов мероприятия. **опционально**
6. `photos` - файлы новох изображения мероприятия в jpg или png формате. Максимум 10 файлов. Будут обрезаны по центру до 1024 пикселей по тем сторонам, которые больше этого значения. Каждый файл должен быть меньше 5мб. **опционально**

Содержимое объектов JSON массива `schedule`:

1. `dateFrom` - Дата начала отдельной встречи мероприятия (дата со временем в ISO формате в UTC).
2. `dateTo` - Дата окончания отдельной встречи мероприятия (дата со временем в ISO формате в UTC). Должна быть позже, чем дата начала. Должна равняться дате начала мероприятия, если мероприятие не продолжительно во времени.
3. `address` - Текстовое описание адреса проведения мероприятия, который должен описывать конкретную точку. После создания, по этому адресу будут геокодированы географические координаты. **опционально**
4. `latitude` и `longitude` - Альтернатива текстовому адресу в виде географических координат широты и долготы. После создания, по координатам будет геокодирован тестовой адрес. **опционально**


#### Запрос с помощью curl:

```bash
curl -L -X PUT 'API_PREFIX/event/update/7886648b-6b98-492e-abe0-dd7d66b38bba' \
-H 'Authorization: ADMIN_TOKEN' \
-F 'description="Измененное описание2"'
```

#### Ответ:

##### 200 OK:

```json
{
    "success":true
}
```

### Удаление мероприятия:

`DELETE API_PREFIX/event/remove/:UUID`

Удаление конкретного мероприятия.

#### Параметры:

*UUID* - UUID конкретного мероприятия. 

#### Запрос с помощью curl:

```bash
curl --location --request DELETE 'API_PREFIX/event/remove/1a4d8e9f-96c7-4b5c-b23c-2e584f9b4fbc' \
--header 'Authorization: ADMIN_API_TOKEN'
```

#### Ответ:

##### 200 OK:

```json
{
    "success": true
}
```

##### 404 Not found:

```json
{
    "success": false,
    "code": "notfound",
    "msg": "Event not exist!"
}
```

### Назначение ответственного организатора:

`PUT API_PREFIX/event/:eventId/organizeBy/:userId`

Установка (добавление) ответственного организатора на мероприятие.

#### Параметры:

*eventId* - UUID конкретного мероприятия. 
*userId* - UUID конкретного организатора. 

#### Запрос с помощью curl:

```bash
curl -L -X PUT 'API_PREFIX/event/:eventId/organizeBy/:userId' \
-H 'Authorization: ADMIN_TOKEN'
```

#### Ответ:

##### 200 OK:

```json
{
    "success": true
}
```

##### 409 Conflict (Если организатор уже установлен ответственным):

```json
{
    "success": false,
    "code": "conflict",
    "msg": "Already organize the event!"
}
```

### Снятие ответственного организатора:

`PUT API_PREFIX/event/:eventId/disorganize/:userId`

Снятие (удаление) ответственного организатора с мероприятия.

#### Параметры:

*eventId* - UUID конкретного мероприятия. 
*userId* - UUID конкретного организатора. 

#### Запрос с помощью curl:

```bash
curl -L -X PUT 'API_PREFIX/event/:eventId/disorganize/:userId' \
-H 'Authorization: ADMIN_TOKEN'
```

#### Ответ:

##### 200 OK:

```json
{
    "success": true
}
```

##### 409 Conflict (Если организатор не является ответственным):

```json
{
    "success": false,
    "code": "conflict",
    "msg": "Not organize the event!"
}
```

## Пользовательский уровень доступа:

### Редактирование мероприятия организатором:

Организатор имеет право редактировать мероприятия, используя API администратора для тех мероприятий, где он ответственный

### Оценка прошедшего мероприятия:

`PUT API_PREFIX/event/:eventId/rate/:rating`

Оценивание мероприятия по пятибальной шкале.

#### Параметры:

*eventId* - UUID конкретного мероприятия. 
*rating* - оценка от 0 (снятие оценки) до 5 (высший балл). 

#### Запрос с помощью curl:

```bash
curl -L -X PUT 'API_PREFIX/event/:eventId/rate/:rating' \
-H 'Authorization: JWT'
```

#### Ответ:

##### 200 OK:

```json
{
    "success": true
}
```

## Публичный уровень доступа:

### Получение списка мероприятий:

`GET API_PREFIX/event/`

Получение списка всех мероприятий.

#### Запрос с помощью curl:

```bash
curl --location --request GET 'API_PREFIX/v3/event/'
```

#### Ответ:

##### 200 OK:

```json
{
    "success": true,
    "events": [
        {
            "thumbnail": "URL_HOST/storage/images/5b2bea17786b0d1e/picture0_1624336286165.jpg",
            "id": "2e325b29-a4e9-4de4-b120-8c463a9f667f",
            "title": "Новое мероприятие",
            "membersCount": 0,
            "rating": 0,
            "region": {
                "id": "0bb20518-a009-44a3-9308-669ace79b63d",
                "name": "Севастополь"
            },
            "Tags": [
                "Театр"
            ],
            "Schedules": [
                {
                    "dateFrom": "2020-12-12T10:20:30.000Z",
                    "dateTo": "2020-12-12T12:20:30.000Z",
                    "address": "улица Меньшикова, 17",
                    "longitude": 33.484541,
                    "latitude": 44.595272
                },
                {
                    "dateFrom": "2020-12-10T10:20:30.000Z",
                    "dateTo": "2020-12-10T12:20:30.000Z",
                    "address": "улица Тараса Шевченко, 52",
                    "longitude": 33.457331,
                    "latitude": 44.572026
                }
            ]
        }
    ]
}
```

### Получение информации о мероприятии:

`GET API_PREFIX/event/:UUID`

Получение информации о конкретном мероприятии.

#### Параметры:

*UUID* - uuid мероприятия

#### Запрос с помощью curl:

```bash
curl --location --request GET 'API_PREFIX/event/72a0394a-7052-4761-8d95-9984765d3ade'
```

#### Ответ:

##### 200 OK:

```json
{
    "success": true,
    "eventNote": {
        "id": "2e325b29-a4e9-4de4-b120-8c463a9f667f",
        "title": "Новое мероприятие",
        "description": "Описание меропрития",
        "membersCount": 1,
        "rating": 0,
        "region": {
            "id": "0bb20518-a009-44a3-9308-669ace79b63d",
            "name": "Севастополь"
        },
        "Photos": [
            "HOST_URL/storage/images/5b2bea17786b0d1e/picture0_1624336286165.jpg"
        ],
        "Tags": [
            "Театр"
        ],
        "Schedules": [
            {
                "dateFrom": "2020-12-10T10:20:30.000Z",
                "dateTo": "2020-12-10T12:20:30.000Z",
                "address": "улица Тараса Шевченко, 52",
                "longitude": 33.457331,
                "latitude": 44.572026
            },
            {
                "dateFrom": "2020-12-12T10:20:30.000Z",
                "dateTo": "2020-12-12T12:20:30.000Z",
                "address": "улица Меньшикова, 17",
                "longitude": 33.484541,
                "latitude": 44.595272
            }
        ]
    }
}
```

##### 404 Not Found:

```json
{
    "success": false,
    "code": "notfound",
    "msg": "Event not exist!"
}
```
